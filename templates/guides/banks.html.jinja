{% extends "_layout.html" %}
{% set entry = entries['guides/best-bank-germany.md'] %}
{% set metatitle = entry.title %}
{% set metadescription = entry.description %}
{% set related_collections = [] %}
{% for collection in get_entries('collections', sort_by='order') %}
	{% if entry in collection.related_guides %}
		{% do related_collections.append(collection) %}
	{% endif %}
{% endfor %}

{% block postHead %}
	{{ super() }}
	<link rel="index" href="{{ site_url }}/guides">
{% endblock %}

{% block main %}
	<main aria-label="Main page">
		{% block precontent %}{% endblock %}
		<article class="section">
			<h1>{{ entry.title }}</h1>
			{% include "_blocks/postMeta.html" %}
			{% with entry=entry, showRelatedEntriesLink=related_collections|length %}
				<div class="article-body">
				{% with static=True %}
				   {% include "_blocks/healthInsuranceCalculator.html" %}
				{% endwith %}
				</div>
			{% endwith %}
		</article>

		{% with pageType='guide' %}
			{% include "_blocks/donationPrompt.html" %}
		{% endwith %}

		{% if related_collections %}
			<aside id="related" class="section no-print" aria-label="Collections that include this guide">
				<h2>Related guides</h2>
				{% with collections=related_collections, currentEntry=entry %}
					{% include "_blocks/collections.html" %}
				{% endwith %}
			</aside>
		{% endif %}
		<aside class="section no-print" aria-label="Affiliate links notice" data-nosnippet>
			<p>
				<strong>This guide might contain affiliate links.</strong> When you click those links and buy something, I make a little money. This allows me to work on this website full time.
			</p>
		</aside>
	</main>
	
	<div class="sidebar" aria-hidden="true">
		{% with entry=entry, showRelatedEntriesLink=related_collections|length %}
			{% include '_blocks/tableOfContents.html' %}
		{% endwith %}
		<button class="button open-close" title="Show/hide table of contents">
			{% include "_css/icons/table-of-contents.svg" %}
		</button>
	</div>
	{% include "_js/sidebar.js" %}
{% endblock %}

{% block postFooter %}
	{{ super() }}
	<script type="application/ld+json">
		[
			{
				"@context": "http://schema.org",
				"@type": "WebPage",
				"name": {{ entry.title|tojson }},
				"description": {{ entry.description|tojson }},
				{% if entry.image_url|default %}"image": "{{ entry.image_url }}",{% endif %}
				"breadcrumb": {
					"@context": "https://schema.org",
					"@type": "BreadcrumbList",
					"itemListElement": [
						{
							"@type": "ListItem",
							"position": 1,
							"item": {
								"@id": "{{ site_url }}/",
								"name": "Home"
							}
						},
						{
							"@type": "ListItem",
							"position": 2,
							"item": {
								"@id": "{{ site_url }}/guides",
								"name": "Guides"
							}
						},
						{
							"@type": "ListItem",
							"position": 3,
							"item": {
								"@id": "{{ entry.url }}",
								"name": {{ entry.title|tojson }}
							}
						}
					]
				},
				"author": {
					"@type": "Person",
					"@id": "https://nicolasbouliane.com"
				},
				"reviewedBy": [
					{% set reviews = entry.related_reviews|default([]) %}
					{% for review in reviews %}
						{% set reviewer = review.related_expert[0] %}
						{
							"@context": "https://schema.org/",
							"@type": "Person",
							"jobTitle": {{ reviewer.job_title|tojson }},
							"name": {{ reviewer.name|tojson }},
							"email": {{ reviewer.email|tojson }}
							{% if reviewer.picture|default %}, "image": "{{ site_url }}/{{ reviewer.picture }}"{% endif %}
							{% if reviewer.website|default %}
								, "sameAs": [
									{{ reviewer.website|tojson }}
								]
							{% endif %}
						}{% if not loop.last %},{% endif %}
					{% endfor %}
				],
				{% if reviews|length %}
					"lastReviewed": "{{ reviews[0].date_reviewed.strftime('%Y-%m-%d') }}",
				{% endif %}
				"publisher": {
					"@type": "Organization",
					"@id": "{{ site_url }}/#organization"
				}
			},
			{% include "_blocks/guideJsonld.json" %}
		]
	</script>
{% endblock %}
