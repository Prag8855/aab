{% include '_js/constants.js' %}
{% include '_js/health-insurance-calculator.js' %}
{% include '_js/utils.js' %}
{% include '_js/vue.js' %}
{% include '_js/vue/age-input.js' %}
{% include '_js/vue/collapsible.js' %}
{% include '_js/vue/eur.js' %}
{% include '_js/vue/glossary.js' %}
{% include '_js/vue/health-insurance-question.js' %}
{% include '_js/vue/income-input.js' %}
{% include '_js/vue/mixins/userDefaultsMixin.js' %}
{% include '_js/vue/occupation-input.js' %}
{% include '_js/vue/mixins/multiStageMixin.js' %}
{% include '_js/vue/mixins/trackedStagesMixin.js' %}
{% include '_js/vue/mixins/uniqueIdsMixin.js' %}
{% js %}
	document.querySelectorAll('collapsible.health-insurance-calculator').forEach(
		el => new Vue({
			el: el,
			mixins: [userDefaultsMixin, multiStageMixin, uniqueIdsMixin, trackedStagesMixin],
			data() {
				return {
					age: userDefaults.age,
					childrenCount: userDefaults.childrenCount,
					inputIncome: userDefaults.useMonthlyIncome ? Math.round(userDefaults.yearlyIncome / 12) : userDefaults.yearlyIncome,
					occupation: null,
					isMarried: userDefaults.isMarried,
					useMonthlyIncome: userDefaults.useMonthlyIncome,
					yearlyIncome: userDefaults.yearlyIncome,
					worksOver20HoursPerWeek: false,

					preference: null,

					trackAs: 'Health insurance calculator',
					stages: [
						'start',
						'questions',
						'options',
						'askABroker',
					],
					inputsToFocus: {
						start: () => this.$refs.startButton,
						oldAddress: () => this.$refs.oldAddressInput,
						newAddress: () => this.$refs.newAddressInput,
						addPeople: () => this.$refs.firstNameInput[0],
					},

					formatPercent,
					pflegeversicherung,
					healthInsurance,
				}
			},
			mounted(){
				if(this.useMonthlyIncome){
					this.inputIncome = this.monthlyIncome;
				}
				else{
					this.inputIncome = this.yearlyIncome;
				}
			},
			computed: {
				isStudent() {
					return occupations.isStudent(this.occupation);
				},
				result() {
					return calculateHealthInsuranceContributions({
						age: +this.age,
						monthlyIncome: this.occupation === 'unemployed' ? 0 : +this.monthlyIncome,
						occupation: this.occupation,
						isMarried: this.isMarried,
						childrenCount: this.childrenCount,
						hoursWorked: this.worksOver20HoursPerWeek ? 30 : 20,
					});
				},
				salaryOrIncome() {
					return occupations.isEmployed(this.occupation) ? 'Salary' : 'Income';
				},
				tarifName() {
					return {
						employee: 'employee',
						midijob: 'midijob',
						selfEmployed: 'self-employed',
						selfPay: this.flag('minijob') ? 'minijob' : 'self-pay',
						student: 'student',
						azubi: 'apprentice',
					}[this.result.tarif];
				},
				monthlyIncome() {
					return this.yearlyIncome / 12;
				},
				minTotal() {
					return this.result.options.cheapest.total;
				},
				maxTotal() {
					return this.result.options.mostExpensive.total;
				},
				baseContributionRate() {
					return this.formatPercent(this.result.baseContribution.totalRate * 100);
				},
				isUnemployed() {
					return occupations.isUnemployed(this.occupation);
				},
				showFreeOptions(){
					return this.flag('familienversicherung-parents')
						|| this.flag('familienversicherung-spouse')
						|| this.flag('alg-i-buergergeld')
						|| this.flag('ehic');
				},
				yourSponsorsHave() {
					if(this.flag('familienversicherung-parents') && this.flag('familienversicherung-spouse')){
						return 'your parents or your spouse have';
					}
					else if(this.flag('familienversicherung-spouse')){
						return 'your spouse has';
					}
					else if(this.flag('familienversicherung-parents')){
						return 'your parents have';
					}
				},
			},
			methods: {
				flag(flagName){
					return this.result.flags.has(flagName);
				},
				eur(num) {
					return formatCurrency(num, false, '€', false);
				},
			},
			watch: {
				inputIncome(newIncome){
					this.yearlyIncome = this.useMonthlyIncome ? newIncome * 12 : newIncome;
				},
			}
		})
	);
{% endjs %}

<collapsible class="health-insurance-calculator" {% if static|default %}static{% endif %}>
{% raw %}
	<template v-slot:header>Health insurance picker</template>

	<progress v-if="stage !== 'start'" aria-label="Form progress" :max="stages.length - 1" :value="stageIndex"></progress>

	<template v-if="stage === 'start'">
		<p>Let's get you insured. What is your occupation?</p>
		<ul class="buttons grid" aria-label="Occupations">
			<li>
				<button @click="occupation = 'employee'; nextStage()">
					{% endraw %}{% include "_css/icons/job.svg" %}{% raw %}
					Employee
				</button>
			</li>
			<li>
				<button @click="occupation = 'studentUnemployed'; nextStage()">
					{% endraw %}{% include "_css/icons/student.svg" %}{% raw %}
					Student
				</button>
			</li>
			<li>
				<button @click="occupation = 'selfEmployed'; nextStage()">
					{% endraw %}{% include "_css/icons/business.svg" %}{% raw %}
					Self-employed
				</button>
			</li>
			<li>
				<button @click="occupation = 'intern'; nextStage()">
					{% endraw %}{% include "_css/icons/helper.svg" %}{% raw %}
					Intern
				</button>
			</li>
			<li>
				<button @click="occupation = 'azubi'; nextStage()">
					{% endraw %}{% include "_css/icons/helper.svg" %}{% raw %}
					Apprentice
				</button>
			</li>
			<li>
				<button @click="occupation = 'unemployed'; nextStage()">
					{% endraw %}{% include "_css/icons/visiting.svg" %}{% raw %}
					Unemployed
				</button>
			</li>
		</ul>
	</template>

	<template v-if="stage === 'questions'">
		<h3>Tell us a bit more about you&hellip;</h3>
		<p>It helps us calculate prices and recommend the right health insurance.</p>
		<hr>
		<div class="form-group">
			<label :for="uid('age')">
				Age
			</label>
			<div class="input-group">
				<age-input :id="uid('age')" v-model="age"></age-input>
				years old
			</div>
		</div>
		<div class="form-group">
			<label :for="uid('children-count')">
				Family situation
			</label>
			<div class="input-group vertical">
				<div class="input-group">
					<button class="toggle" @click="isMarried = !isMarried">{{ isMarried ? 'Married' : 'Not married' }}</button>
					<select v-model="childrenCount">
						<option :value="0">No children</option>
						<option :value="1">1 child</option>
						<option :value="2">2 children</option>
						<option :value="3">3 children</option>
						<option :value="4">4 children</option>
						<option :value="5">5 children</option>
						<option :value="6">6+ children</option>
					</select>
				</div>
			</div>
		</div>
		<div class="form-group" v-if="isStudent">
			<label :for="uid('studentOccupation')">
				Other occupation
			</label>
			<div class="input-group vertical">
				<label class="checkbox">
					<input type="radio" :name="uid('studentOccupation')" v-model="occupation" value="studentUnemployed" required>
					I am unemployed
				</label>
				<label class="checkbox">
					<input type="radio" :name="uid('studentOccupation')" v-model="occupation" value="studentEmployee" required>
					I have a job
				</label>
				<label class="checkbox">
					<input type="radio" :name="uid('studentOccupation')" v-model="occupation" value="studentSelfEmployed" required>
					I am self-employed
				</label>
			</div>
		</div>
		<div class="form-group" v-if="!isUnemployed">
			<label :for="uid('income')">
				{{ salaryOrIncome }}
			</label>
			<div class="input-group">
				<income-input :id="uid('income')" v-model="inputIncome"></income-input>
				€
				<button class="toggle" @click="useMonthlyIncome = !useMonthlyIncome">per {{ useMonthlyIncome ? 'month' : 'year' }}</button>
				before taxes
			</div>
			<label class="input-group" v-if="isStudent">
				<input type="checkbox" v-model="worksOver20HoursPerWeek">
				I work more than 20 hours per week
			</label>
		</div>
		<hr>
		<div class="buttons bar">
			<button class="button" @click="goToStage('start')">
				<i class="icon left" aria-hidden="true"></i> Go back
			</button>
			<button class="button primary" @click="nextStage('options')">
				See options <i class="icon right" aria-hidden="true"></i>
			</button>
		</div>
	</template>
	<template v-if="stage === 'options'">
		<template v-if="showFreeOptions">
			<h3>Free health insurance</h3>
			<p>You can get free <glossary term="gesetzliche Krankenversicherung">public health insurance</glossary> because you have a low income.</p>
			<ul class="buttons list">
				<li v-if="flag('alg-i-buergergeld')">
					<a title="Learn more about state-sponsored health insurance" href="/guides/german-health-insurance#free-health-insurance" target="_blank">
						{% endraw %}{% include "_css/icons/bank.svg" %}{% raw %}
						<div>
							<h3>Paid by social benefits</h3>
							<p>
								If you get <glossary term="ALG I">unemployment benefits</glossary>, <glossary>Bürgergeld</glossary> or <glossary>Elterngeld</glossary>, you get free health insurance.
							</p>
						</div>
						<output>
							<eur :amount="0"></eur> <small>per month</small>
						</output>
					</a>
				</li>
				<li v-if="flag('familienversicherung-spouse') || flag('familienversicherung-parents')">
					<a title="Learn more about family health insurance" href="/guides/german-health-insurance#free-health-insurance" target="_blank">
						{% endraw %}{% include "_css/icons/family.svg" %}{% raw %}
						<div>
							<h3><glossary term="Familienversicherung">Family insurance</glossary></h3>
							<p>
								If {{ yourSponsorsHave }} public health insurance, it covers you for free.
							</p>
						</div>
						<output>
							<eur :amount="0"></eur> <small>per month</small>
						</output>
					</a>
				</li>
				<li v-if="flag('ehic')">
					<a title="Learn more about the EHIC" href="/guides/german-health-insurance#insurance-from-other-eu-countries" target="_blank">
						{% endraw %}{% include "_css/icons/passport.svg" %}{% raw %}
						<div>
							<h3>European Health Insurance Card</h3>
							<p>Your insurance from another EU country might cover you for free.</p>
						</div>
						<output>
							<eur :amount="0"></eur> <small>per month</small>
						</output>
					</a>
				</li>
			</ul>
			<hr>
		</template>
		<h3>Public health insurance</h3>
		<p v-if="flag('azubi-free')">
			You make less than <eur :amount="healthInsurance.azubiFreibetrag"></eur> per month, so your employer pays for your health insurance. You must still choose an insurer.
		</p>
		<p v-else>
			<template v-if="showFreeOptions">If you can't get free health insurance, it costs</template>
			<template v-if="!showFreeOptions">
				<glossary term="gesetzliche Krankenversicherung">Public health insurance</glossary>
				<template v-if="!flag('private') && !showFreeOptions">is your only option. It </template>costs</template>
			<strong>
				<output v-if="maxTotal === 0">
					<eur :amount="0"></eur>
				</output>
				<output v-if="eur(minTotal.personalContribution) === eur(maxTotal.personalContribution) && maxTotal.personalContribution > 0">
					<eur :amount="maxTotal.personalContribution"></eur>
				</output>
				<output v-if="eur(minTotal.personalContribution) != eur(maxTotal.personalContribution) && maxTotal.personalContribution > 0">
					<eur :amount="minTotal.personalContribution" no-symbol></eur>
					to
					<eur :amount="maxTotal.personalContribution"></eur>
				</output>
				per month</strong>, depending on the insurer.

			<template v-if="flag('private') && childrenCount > 2">It's usually the cheapest option, because it covers your {{ childrenCount }} children for free.</template>
			<template v-if="flag('private') && age > 45">If you are over 45 years old, it's usually the cheapest option.</template>
			
			<template v-if="flag('private') && isStudent && !flag('student-30plus')">
				<glossary term="gesetzliche Krankenversicherung">Public health insurance</glossary> is usually the best option for students under 30 years old.
			</template>

			<template v-else-if="flag('not-nebenjob') && worksOver20HoursPerWeek">
				You work more than 20 hours per week, so you can't get the student tarif.
			</template>
			<template v-if="flag('private') && isStudent && flag('student-30plus') && age <= 45 && childrenCount <= 2">
				You are over 30 years old, so you can't get the student tariff. Private health insurance might be cheaper than public.
			</template>
			<template v-if="occupation === 'selfEmployed' && yearlyIncome <= 30000">
				If you make less than <eur :amount="30000"></eur> per year, it's the safest option.
			</template>
		</p>
		<p>
			You must choose an insurer. There are dozens of options, but their cost and coverage are almost the same.
		</p>
		<ul class="buttons list">
			<li>
				<a title="Sign up with BARMER" href="/out/barmer" target="_blank">
					{% endraw %}{% include "_css/icons/health-insurance/logo-barmer.svg" %}{% raw %}
					<div>
						<h3>Barmer</h3>
						<p>Easiest sign-up for expats. Second biggest health insurer. They speak English.</p>
					</div>
					<output>
						<eur :amount="result.options.barmer.total.personalContribution"></eur> <small>per month</small>
					</output>
				</a>
			</li>
			<li>
				<a title="Sign up with Techniker Krankenkasse" href="/out/feather-tk" target="_blank">
					{% endraw %}{% include "_css/icons/health-insurance/logo-tk.svg" %}{% raw %}
					<div>
						<h3>Techniker Krankenkasse</h3>
						<p>Biggest German health insurer. They speak English.</p>
					</div>
					<output>
						<eur :amount="result.options.tk.total.personalContribution"></eur> <small>per month</small>
					</output>
				</a>
			</li>
			<li>
				<button class="recommended" @click="preference = 'public'; goToStage('askABroker')">
					{% endraw %}{% include "_css/icons/help.svg" %}{% raw %}
					<div>
						<h3>Let an expert choose</h3>
						<p>Ask an independent insurance broker to choose the best public health insurance. They speak English.</p>
					</div>
				</button>
			</li>
		</ul>
		<details class="cost-explanation">
			<summary>Cost explanation</summary>
			<p>
				You pay the <strong>{{ tarifName }} tarif</strong>.
				<template v-if="result.tarif === 'employee'">
					Your health insurance costs a percentage of your income. Your employer pays half of it.
				</template>
				<template v-if="result.tarif === 'selfEmployed'">
					Your health insurance costs a percentage of your income.
				</template>
				<template v-if="result.tarif === 'student'">
					Your health insurance has a fixed price.
				</template>
				<template v-if="result.tarif === 'selfPay'">
					<template v-if="flag('minijob')">
						You pay the <glossary term="Mindestbeitrag">minimum price</glossary>.
					</template>
					<template v-else>
						Your health insurance costs a percentage of your income.
					</template>
				</template>
				<template v-if="result.tarif === 'midijob'">
					It's a cheaper tarif for low-income jobs.
				</template>
				<template v-if="result.tarif === 'azubi'">
					You make less than <eur :amount="healthInsurance.azubiFreibetrag"></eur> per month, so you don't pay for health insurance. Your employer pays for it.
				</template>

				<template v-if="flag('student-30plus')">
					You can't get the student tarif because you are over 30 years old.
				</template>
				<template v-else-if="flag('not-nebenjob') && worksOver20HoursPerWeek">
					You can't get the student tarif because you work more than 20 hours per week.
				</template>
				<template v-else-if="flag('not-nebenjob') && !worksOver20HoursPerWeek">
					You can't get the student tarif because your income is too high.
				</template>
			</p>
			<hr>
			<details>
				<summary class="price">
					Base cost
					<output>
						<eur :amount="result.baseContribution.totalContribution"></eur><small class="no-mobile">/month</small>
					</output>
				</summary>
				<p>
					<template v-if="flag('minijob')">
						You have a minijob, so you pay the <glossary term="Mindestbeitrag">minimum price</glossary>. It's {{ baseContributionRate }} of <eur :amount="healthInsurance.minMonthlyIncome"></eur> }}.
					</template>
					<template v-else-if="flag('min-contribution')">
						You make less than <eur :amount="healthInsurance.minMonthlyIncome"></eur> per month, so you pay the <glossary term="Mindestbeitrag">minimum price</glossary>. It's {{ baseContributionRate }} of <eur :amount="healthInsurance.minMonthlyIncome"></eur>.
					</template>
					<template v-else-if="flag('max-contribution')">
						You make more than <eur :amount="healthInsurance.maxMonthlyIncome"></eur> per month, so you pay the <glossary term="Höchstbeitrag">maximum price</glossary>. It's {{ baseContributionRate }} of <eur :amount="healthInsurance.maxMonthlyIncome"></eur>.
					</template>
					<template v-else-if="flag('midijob')">
						You make less than <eur :amount="healthInsurance.midijobMaxIncome"></eur> per month, so you pay the midijob tarif. It's cheaper than the normal tarif.
					</template>
					<template v-else-if="result.tarif === 'student'">
						You pay the student tarif; the base cost is a fixed price.
					</template>
					<template v-else>
						You pay {{ baseContributionRate }} of your income.
					</template>
					The base cost is the same for all insurers.
				</p>
			</details>
			<details>
				<summary class="price">
					Insurer surcharge
					<output
						v-if="eur(result.options.cheapest.zusatzbeitrag.totalContribution) === eur(result.options.mostExpensive.zusatzbeitrag.totalContribution)">
						<eur :amount="result.options.mostExpensive.zusatzbeitrag.totalContribution"></eur>
					</output>
					<output v-else>
						<eur :amount="result.options.cheapest.zusatzbeitrag.totalContribution" no-symbol></eur>
						&nbsp;to&nbsp;
						<eur :amount="result.options.mostExpensive.zusatzbeitrag.totalContribution"></eur><small class="no-mobile">/month</small>
					</output>
				</summary>
				<p>
					Insurers can charge more to offer better services. Each insurer has a different surcharge. The average surcharge is {{ formatPercent(healthInsurance.avgZusatzbeitrag * 100) }} of your income.
				</p>
			</details>
			<details>
				<summary class="price">
					Long-term care insurance
					<output>
						<eur :amount="result.pflegeversicherung.totalContribution"></eur><small class="no-mobile">/month</small>
					</output>
				</summary>
				<p>
					<template v-if="flag('max-contribution')">
						You pay the <glossary term="Höchstbeitrag">maximum price</glossary>, because you make more than <eur :amount="healthInsurance.maxMonthlyIncome"></eur> per month.
					</template>
					<template v-else>
						You pay {{ formatPercent(result.pflegeversicherung.totalRate * 100) }} of your income.
						<template v-if="age > pflegeversicherung.defaultTarifMaxAge && childrenCount === 0">
							It costs more because you are over {{ pflegeversicherung.defaultTarifMaxAge }} years old and you don't have children.
						</template>
						<template v-else-if="age <= pflegeversicherung.defaultTarifMaxAge">
							It costs less because you are under {{ pflegeversicherung.defaultTarifMaxAge + 1 }} years old.
						</template>
						<template v-else>
							It costs less because you have children.
						</template>
					</template>
					The cost is the same for all insurers.
				</p>
			</details>
			<details>
				<summary class="price">
					Your employer pays
					<output v-if="maxTotal.employerContribution === 0">
						<eur :amount="0"></eur>
					</output>
					<template v-else>
						<output v-if="eur(minTotal.employerContribution) === eur(maxTotal.employerContribution)">
							<eur :amount="maxTotal.employerContribution"></eur><small class="no-mobile">/month</small>
						</output>
						<output v-else>
							<eur :amount="minTotal.employerContribution" no-symbol></eur>
							&nbsp;to&nbsp;
							<eur :amount="maxTotal.employerContribution"></eur><small class="no-mobile">/month</small>
						</output>
					</template>
				</summary>
				<p v-if="result.tarif === 'selfEmployed'">
					You are self-employed, so you don't get help from an employer.
				</p>
				<p v-if="flag('azubi-free')">
					When you make less than <eur :amount="healthInsurance.azubiFreibetrag"></eur> per month, your employer pays for your health insurance.
				</p>
				<p v-if="result.tarif === 'selfPay' && !flag('minijob')">
					You are unemployed, so you don't get help from an employer.
				</p>
				<p v-if="flag('minijob')">
					When you have a <glossary term="Minijob">minijob</glossary>, your employer does not pay for your health insurance.
				</p>
				<p v-if="result.tarif === 'employee'">
					Your employer pays half of your health insurance.
				</p>
				<p v-if="result.tarif === 'midijob'">
					Your employer pays part of your health insurance.
				</p>
			</details>
			<details>
				<summary class="price highlighted">
					You pay
					<output v-if="maxTotal === 0">
						<eur :amount="0"></eur>
					</output>
					<output v-if="eur(minTotal.personalContribution) === eur(maxTotal.personalContribution) && maxTotal.personalContribution > 0">
						<eur :amount="maxTotal.personalContribution"></eur><small class="no-mobile">/month</small>
					</output>
					<output v-if="eur(minTotal.personalContribution) != eur(maxTotal.personalContribution) && maxTotal.personalContribution > 0">
						<eur :amount="minTotal.personalContribution" no-symbol></eur>
						&nbsp;to&nbsp;
						<eur :amount="maxTotal.personalContribution"></eur><small class="no-mobile">/month</small>
					</output>
				</summary>
				<p>
					This is what you pay for public health insurance.
					<template v-if="flag('max-contribution')">
						You make more than <eur :amount="healthInsurance.maxMonthlyIncome"></eur> per month, so you pay the <glossary term="Höchstbeitrag">maximum price</glossary>.
					</template>
					<template v-else-if="flag('min-contribution')">
						You pay the <glossary term="Mindestbeitrag">minimum price</glossary>, because you make less than <eur :amount="healthInsurance.minMonthlyIncome"></eur> per month.
					</template>
					<template v-else-if="flag('azubi-free')">
						You pay nothing, because you make less than <eur :amount="healthInsurance.azubiFreibetrag"></eur> per month. Your employer pays for your insurance.
					</template>
					This is a <glossary term="steuerlich absetzbar">tax-deductible</glossary> expense.
				</p>
			</details>
		</details>
		<hr>

		<h3>Private health insurance</h3>
		<p v-if="!flag('private')">
			You can't choose <glossary term="private Krankenversicherung">private health insurance</glossary> because your income is too low.
		</p>
		<template v-if="flag('private')">
			<p v-if="occupation === 'employee'">
				<template v-if="age <= 35">If you are young and well-paid, <glossary term="private Krankenversicherung">private health insurance</glossary> is usually cheaper and better.</template>
				<template v-if="age >= 45">If you are over 45 years old, <glossary term="private Krankenversicherung">private health insurance</glossary> is usually more expensive than public, but you can get better, faster healthcare.</template>
			</p>

			<p v-if="occupation === 'selfEmployed'">
				<template v-if="yearlyIncome >= 30000">
					<glossary term="private Krankenversicherung">Private health insurance</glossary> often the best option for freelancers. It might be your only option, because public health insurers can reject you.
				</template>
				<template v-else>
					If you earn less than <eur :amount=30000></eur> per year, <glossary term="private Krankenversicherung">private health insurance</glossary> is usually a bad idea. Insurers might reject you because your income is too low.
				</template>
			</p>

			<p v-if="occupation === 'unemployed'">
				You can get <glossary term="private Krankenversicherung">private health insurance</glossary>, but most insurers reject unemployed people.
			</p>

			<p v-if="isStudent">
				You can choose <glossary term="private Krankenversicherung">private health insurance</glossary>.
				<template v-if="flag('student-30plus')">For students over 30 years old, private might can be cheaper than public.</template>
				<template v-if="!flag('student-30plus')">For students under 30 years old, private is usually more expensive than public, but you can get better, faster healthcare.</template>
			</p>

			<ul class="buttons list">
				<li>
					<button @click="preference = 'private'; goToStage('askABroker')">
						{% endraw %}{% include "_css/icons/help.svg" %}{% raw %}
						<div>
							<h3>Get a quote</h3>
							<p>Ask an independent expert to compare all options. It's the best way to choose insurance, and it's free. They speak English.</p>
						</div>
					</button>
				</li>
			</ul>
		</template>
		<template v-if="flag('ksk')">
			<hr>
			<h3>Other options</h3>
			<ul class="buttons list">
				<li>
					<a title="Learn more about the KSK" href="/guides/ksk-kuenstlersozialkasse" target="_blank">
						{% endraw %}{% include "_css/icons/liability.svg" %}{% raw %}
						<div>
							<h3>Join the Künstlersozialkasse</h3>
							<p>If you are a freelance artist or publicist, join the KSK. They pay half of your health insurance. It's always worth it.</p>
						</div>
					</a>
				</li>
			</ul>
		</template>

		<hr>
		<div class="buttons bar">
			<button class="button" @click="previousStage()">
				<i class="icon left" aria-hidden="true"></i> Go back
			</button>
			<button class="button primary" @click="preference = null; goToStage('askABroker')">
				Get insured <i class="icon right" aria-hidden="true"></i>
			</button>
		</div>
	</template>
	<health-insurance-question
		v-if="stage === 'askABroker'"
		:age="age"
		:income="yearlyIncome"
		:occupation="occupation"
		:children-count="childrenCount"
		:preference="preference"
		>
		<template v-slot:form-buttons>
			<button class="button" @click="previousStage()">
				<i class="icon left" aria-hidden="true"></i> Go back
			</button>
		</template>
		<template v-slot:after-confirmation>
			<div class="buttons bar">
				<button class="button" @click="goToStage('start')">
					<i class="icon left" aria-hidden="true"></i> Go back
				</button>
			</div>
		</template>
	</health-insurance-question>
{% endraw %}
</collapsible>