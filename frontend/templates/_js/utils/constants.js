{% js %}
const bafogBedarfssatz = {{ BAFOG_BEDARFSSATZ }};

const healthInsurance = {
	defaultRate: {{ GKV_BASE_RATE_EMPLOYEE }}/100,
	selfPayRate: {{ GKV_BASE_RATE_SELF_PAY }}/100,  // Rate without Krankengeld
	studentRate: {{ GKV_BASE_RATE_STUDENT }}/100,
	minMonthlyIncome: {{ GKV_MIN_INCOME }},
	maxMonthlyIncome: {{ GKV_MAX_INCOME }}/12,
	minPrivateMonthlyIncome: {{ PKV_MIN_INCOME }}/12, // Below this amount you get rejected
	minFreiwilligMonthlyIncome: {{ GKV_FREIWILLIG_VERSICHERT_MIN_INCOME }}/12,
	maxFamilienversicherungIncome: {{ GKV_FAMILIENVERSICHERUNG_MAX_INCOME }},
	maxMidijobIncome: {{ MIDIJOB_MAX_INCOME }},
	azubiFreibetrag: {{ GKV_AZUBI_FREIBETRAG }},
	maxNebenjobIncome: {{ GKV_NEBENJOB_MAX_INCOME }},
	factorF: {{ GKV_FACTOR_F }},
	kskMinimumIncome: {{ KSK_MIN_INCOME }},
	kskMinimumHealthInsuranceIncome: {{ KSK_MIN_HEALTH_INSURANCE_INCOME }},
	averageZusatzbeitrag: {{ GKV_ZUSATZBEITRAG_AVERAGE }}/100,
	companies: {
		aok: {
			name: 'AOK Nordost',
			zusatzbeitrag: {{ GKV_ZUSATZBEITRAG_AOK }}/100,
		},
		barmer: {
			name: 'Barmer',
			zusatzbeitrag: {{ GKV_ZUSATZBEITRAG_BARMER }}/100,
		},
		dak: {
			name: 'DAK',
			zusatzbeitrag: {{ GKV_ZUSATZBEITRAG_DAK }}/100,
		},
		hkk: {
			name: 'hkk',
			zusatzbeitrag: {{ GKV_ZUSATZBEITRAG_HKK }}/100,
		},
		tk: {
			name: 'Techniker Krankenkasse',
			zusatzbeitrag: {{ GKV_ZUSATZBEITRAG_TK }}/100,
		},
	},
	private: {
		{{ fail_on('2026-01-31') }}
		pflegeversicherung: [  // Ages 0-99
			45.82,
			45.82,
			45.82,
			45.82,
			45.82,
			45.82,
			45.82,
			45.82,
			45.82,
			45.82,
			45.82,
			45.82,
			45.82,
			45.82,
			45.82,
			45.82,
			45.82,
			45.82,
			45.82,
			46.90,
			48.05,
			49.28,
			50.50,
			51.75,
			53.02,
			54.30,
			55.61,
			56.95,
			58.32,
			59.72,
			61.16,
			62.64,
			64.17,
			65.75,
			67.40,
			69.11,
			70.89,
			72.74,
			74.68,
			76.70,
			78.81,
			81.02,
			83.33,
			85.76,
			88.31,
			90.98,
			93.79,
			96.75,
			99.86,
			103.14,
			106.61,
			110.26,
			114.12,
			118.18,
			122.46,
			126.96,
			131.67,
			136.69,
			142.02,
			147.70,
			153.76,
			160.21,
			167.09,
			174.44,
			182.28,
			190.66,
			199.62,
			209.22,
			219.54,
			230.65,
			242.63,
			255.58,
			269.58,
			284.73,
			301.09,
			318.78,
			337.87,
			358.49,
			380.80,
			404.99,
			431.32,
			460.05,
			491.47,
			525.82,
			563.33,
			604.13,
			648.26,
			695.68,
			746.22,
			799.68,
			855.73,
			914.04,
			974.21,
			1035.81,
			1098.32,
			1161.13,
			1223.40,
			1283.83,
			1341.62,
			1396.03,
		],
		pflegeversicherungStudent: 25.97, // Fixed price, and only for the student age range
		krankentagegeld: {
			15: 2.08,
			16: 2.12,
			17: 2.16,
			18: 2.20,
			19: 2.24,
			20: 2.28,
			21: 2.32,
			22: 2.38,
			23: 2.42,
			24: 2.48,
			25: 2.52,
			26: 2.58,
			27: 2.64,
			28: 2.70,
			29: 2.76,
			30: 2.84,
			31: 2.90,
			32: 2.98,
			33: 3.06,
			34: 3.14,
			35: 3.22,
			36: 3.32,
			37: 3.40,
			38: 3.52,
			39: 3.62,
			40: 3.74,
			41: 3.88,
			42: 4.00,
			43: 4.14,
			44: 4.30,
			45: 4.46,
			46: 4.64,
			47: 4.82,
			48: 5.02,
			49: 5.22,
			50: 5.44,
			51: 5.70,
			52: 5.96,
			53: 6.26,
			54: 6.58,
			55: 6.94,
			56: 7.30,
			57: 7.68,
			58: 8.08,
			59: 8.50,
			60: 8.50,
			61: 8.52,
			62: 8.52,
			63: 8.52,
			64: 8.52,
		},
		tariffs: {
			basic: {
				name: "Hallesche NK.select S 1200",
				deductible: 1200,
				baseContribution: [
					161.93,
					161.93,
					161.93,
					161.93,
					161.93,
					161.93,
					161.93,
					161.93,
					161.93,
					161.93,
					161.93,
					161.93,
					161.93,
					161.93,
					161.93,
					161.93,
					161.93,
					193.24,
					193.24,
					193.24,
					193.24,
					220.48,
					226.09,
					231.84,
					237.71,
					243.57,
					249.44,
					255.31,
					261.17,
					267.02,
					272.78,
					278.49,
					284.13,
					289.85,
					295.66,
					301.57,
					307.71,
					314.13,
					320.82,
					327.94,
					335.34,
					343.00,
					350.99,
					359.28,
					367.83,
					376.75,
					386.01,
					395.61,
					405.54,
					415.84,
					426.44,
					437.38,
					448.72,
					460.38,
					472.32,
					484.68,
					497.30,
					510.36,
					523.71,
					537.53,
					551.65,
					566.26,
					581.18,
					596.54,
					612.26,
					627.30,
					642.62,
					657.95,
					673.26,
					688.45,
					703.47,
					718.23,
					732.58,
					746.38,
					759.42,
					771.58,
					782.64,
					793.15,
					803.11,
					812.45,
					821.23,
					829.36,
					836.79,
					843.48,
					849.33,
					854.26,
					858.10,
					860.61,
					861.54,
					861.54,
					861.54,
					861.54,
					861.54,
					861.54,
					861.54,
					861.54,
					861.54,
					861.54,
					861.54,
					861.54,
				],
			},
			premium: {
				name: "Hallesche NK.select XL Bonus",
				deductible: 0,
				baseContribution: [
					352.68,
					352.68,
					352.68,
					352.68,
					352.68,
					352.68,
					352.68,
					352.68,
					352.68,
					352.68,
					352.68,
					352.68,
					352.68,
					352.68,
					352.68,
					352.68,
					352.68,
					429.66,
					429.66,
					429.66,
					429.66,
					526.21,
					536.87,
					547.82,
					559.03,
					570.22,
					581.45,
					592.69,
					603.92,
					615.13,
					626.15,
					637.04,
					647.76,
					658.60,
					669.55,
					680.75,
					692.42,
					704.68,
					717.50,
					731.19,
					745.37,
					760.05,
					775.33,
					791.14,
					807.41,
					824.37,
					841.94,
					860.13,
					878.91,
					898.33,
					918.29,
					938.84,
					960.10,
					981.93,
					1004.24,
					1027.26,
					1050.69,
					1074.92,
					1099.59,
					1125.13,
					1151.31,
					1178.54,
					1206.11,
					1234.30,
					1262.78,
					1289.47,
					1316.10,
					1342.63,
					1368.92,
					1394.81,
					1420.17,
					1444.76,
					1468.92,
					1492.43,
					1515.07,
					1536.80,
					1557.45,
					1577.01,
					1595.44,
					1612.72,
					1628.79,
					1643.60,
					1657.14,
					1669.24,
					1679.77,
					1688.54,
					1695.37,
					1699.89,
					1701.52,
					1701.52,
					1701.52,
					1701.52,
					1701.52,
					1701.52,
					1701.52,
					1701.52,
					1701.52,
					1701.52,
					1701.52,
					1701.52,
				],
			},
			basicStudent: {
				name: "Ottonova Study Protect",
				deductible: 500,
				baseContribution: {
					16: 84.28,
					17: 84.28,
					18: 84.28,
					19: 84.28,
					20: 105.38,
					21: 105.38,
					22: 105.38,
					23: 105.38,
					24: 105.38,
					25: 115.71,
					26: 115.71,
					27: 115.71,
					28: 115.71,
					29: 115.71,
					30: 138.98,
					31: 138.98,
					32: 138.98,
					33: 138.98,
					34: 138.98,
					35: 150.12,
					36: 150.12,
					37: 150.12,
					38: 150.12,
				},
			},
			premiumStudent: {
				name: "Ottonova Study Free",
				deductible: 0,
				baseContribution: {
					16: 100.69,
					17: 100.69,
					18: 100.69,
					19: 100.69,
					20: 126.12,
					21: 126.12,
					22: 126.12,
					23: 126.12,
					24: 126.12,
					25: 138.18,
					26: 138.18,
					27: 138.18,
					28: 138.18,
					29: 138.18,
					30: 165.52,
					31: 165.52,
					32: 165.52,
					33: 165.52,
					34: 165.52,
					35: 178.32,
					36: 178.32,
					37: 178.32,
					38: 178.32,
				},
			},
		},
	},
}

const pflegeversicherung = {
	defaultRate: {{ PFLEGEVERSICHERUNG_BASE_RATE }}/100,
	surchargeRate: {{ PFLEGEVERSICHERUNG_MAX_RATE }}/100,
	discountPerChild: {{ PFLEGEVERSICHERUNG_DISCOUNT_PER_CHILD }}/100,
	minimumChildCountForDiscount: {{ PFLEGEVERSICHERUNG_DISCOUNT_MIN_CHILDREN }},
	maximumChildCountForDiscount: {{ PFLEGEVERSICHERUNG_DISCOUNT_MAX_CHILDREN }},
	employerRate: {{ PFLEGEVERSICHERUNG_BASE_RATE }}/100/2, // Employer doesn't contribute to surcharge
	defaultRateMaxAge: {{ PFLEGEVERSICHERUNG_BASE_RATE_MAX_AGE }}, // Above this age, if you don't have kids, you pay the surchargeRate
};

const taxes = {
	church: {
		default: {{ CHURCH_TAX_RATE }} / 100,
		bw: {{ CHURCH_TAX_RATE_BW_BY }} / 100,
		by: {{ CHURCH_TAX_RATE_BW_BY }} / 100,
	},
	arbeitslosenversicherungRate: {{ ARBEITSLOSENVERSICHERUNG_EMPLOYEE_RATE }}/100,
	beitragsbemessungsgrenze: {
		2000: { west: 4500 * 12, east: 3750 * 12 },
		2001: { west: 4500 * 12, east: 3750 * 12 },
		2002: { west: 4500 * 12, east: 3750 * 12 },
		2003: { west: 5100 * 12, east: 4250 * 12 },
		2004: { west: 5150 * 12, east: 4350 * 12 },
		2005: { west: 5200 * 12, east: 4400 * 12 },
		2006: { west: 5250 * 12, east: 4400 * 12 },
		2007: { west: 5250 * 12, east: 4550 * 12 },
		2008: { west: 5300 * 12, east: 4500 * 12 },
		2009: { west: 5400 * 12, east: 4550 * 12 },
		2010: { west: 5500 * 12, east: 4650 * 12 },
		2011: { west: 5500 * 12, east: 4800 * 12 },
		2012: { west: 5600 * 12, east: 4800 * 12 },
		2013: { west: 5800 * 12, east: 4900 * 12 },
		2014: { west: 5950 * 12, east: 5000 * 12 },
		2015: { west: 6050 * 12, east: 5200 * 12 },
		2016: { west: 6200 * 12, east: 5400 * 12 },
		2017: { west: 6350 * 12, east: 5700 * 12 },
		2018: { west: 6500 * 12, east: 5800 * 12 },
		2019: { west: 6700 * 12, east: 6150 * 12 },
		2020: { west: 6900 * 12, east: 6450 * 12 },
		2021: { west: 7100 * 12, east: 6700 * 12 },
		2022: { west: 7050 * 12, east: 6750 * 12 },
		2023: { west: 7300 * 12, east: 7100 * 12 },
		2024: { west: 7550 * 12, east: 7450 * 12 },
		2025: { west: 8050 * 12, east: 8050 * 12 },
		2026: { west: {{ BEITRAGSBEMESSUNGSGRENZE }}, east: {{ BEITRAGSBEMESSUNGSGRENZE }} },
		currentYear: { west: {{ BEITRAGSBEMESSUNGSGRENZE }}, east: {{ BEITRAGSBEMESSUNGSGRENZE }} }, // {{ fail_on('2026-12-31') }}
		2027: { west: {{ BEITRAGSBEMESSUNGSGRENZE }}, east: {{ BEITRAGSBEMESSUNGSGRENZE }} }, // ESTIMATED (2026)
	},
	grundfreibetrag: {{ GRUNDFREIBETRAG }},
	kinderfreibetrag: {{ KINDERFREIBETRAG }},
	entlastungsbetragAlleinerziehende: {{ ENTLASTUNGSBETRAG_ALLEINERZIEHENDE }},
	entlastungsbetragAlleinerziehendePerChild: {{ ENTLASTUNGSBETRAG_ALLEINERZIEHENDE_EXTRA_CHILD }},
	kindergeldPerChild: {{ KINDERGELD }},
	solidarity: { // https://www.finanztip.de/solidaritaetszuschlag/
		minIncomeTax: {{ SOLIDARITY_TAX_MILDERUNGSZONE_MIN_INCOME_TAX }},  // Above this, you pay solidarity tax
		milderungszoneRate: {{ SOLIDARITY_TAX_MILDERUNGSZONE_RATE }}, // percent of incomeTax - minIncomeTax
		maxRate: {{ SOLIDARITY_TAX_MAX_RATE }},
	},
	minVorsorgepauschal: {{ VORSORGEPAUSCHAL_MIN }},
	minVorsorgepauschalTaxClass3: {{ VORSORGEPAUSCHAL_MIN_TAX_CLASS_3 }},
	{{ fail_on('2026-03-01') }}
	incomeTaxBrackets: {  // ยง 32a EStG - https://www.lohn-info.de/lohnsteuerzahlen.html
		1: {
			formula: (x, y, z) => 0,
			minIncome: -Infinity,
			maxIncome: {{ GRUNDFREIBETRAG }},
		},
		2: {
			formula: (x, y, z) => (914.51 * y + 1400) * y,
			minIncome: {{ GRUNDFREIBETRAG }},
			maxIncome: {{ INCOME_TAX_BRACKET_2_MAX_INCOME }},
		},
		3: {
			formula: (x, y, z) => (173.10 * z + 2397) * z + 1034.87,
			minIncome: {{ INCOME_TAX_BRACKET_2_MAX_INCOME }},
			maxIncome: {{ INCOME_TAX_BRACKET_3_MAX_INCOME }},
		},
		4: {
			formula: (x, y, z) => 0.42 * x - 11135.63,
			minIncome: {{ INCOME_TAX_BRACKET_3_MAX_INCOME }},
			maxIncome: {{ INCOME_TAX_BRACKET_4_MAX_INCOME }},
		},
		5: {
			formula: (x, y, z) => {{ INCOME_TAX_MAX_RATE }} / 100 * x - 19470.38,
			minIncome: {{ INCOME_TAX_BRACKET_4_MAX_INCOME }},
			maxIncome: Infinity,
		},
	},
	incomeTaxClass56: {
		maxIncome1: {{ INCOME_TAX_CLASS_56_LIMIT_1 }},
		maxIncome2: {{ INCOME_TAX_CLASS_56_LIMIT_2 }},
		maxIncome3: {{ INCOME_TAX_CLASS_56_LIMIT_3 }},
	},
	maxMinijobIncome: {{ MINIJOB_MAX_INCOME }}, // Max monthly income to be considered a minijobber
	arbeitnehmerpauschale: {{ ARBEITNEHMERPAUSCHALE }}, // Fixed yearly income tax deduction for employees
	sonderausgabenPauschbetrag: {{ SONDERAUSGABEN_PAUSCHBETRAG }}, // Fixed yearly income tax deduction
};

// https://github.com/mledoze/countries/blob/master/dist/countries.json
const pensions = {
	contractingCountries: new Set(['AL', 'AU', 'BR', 'CA', 'CL', 'IN', 'IL', 'JP', 'KR', 'MA', 'ME', 'PH', 'TN', 'TR', 'UY', 'US']),
	balkanBlockCountries: new Set(['BA', 'MK', 'RS', 'XK', 'ME']),
	disqualifyingCountries: new Set(['BA', 'MK', 'RS', 'XK', 'ME', 'TR']),
	contributionRates: {
		2000: 19.3,
		2001: 19.1,
		2002: 19.1,
		2003: 19.5,
		2004: 19.5,
		2005: 19.5,
		2006: 19.5,
		2007: 19.9,
		2008: 19.9,
		2009: 19.9,
		2010: 19.9,
		2011: 19.9,
		2012: 19.6,
		2013: 18.9,
		2014: 18.9,
		2015: 18.7,
		2016: 18.7,
		2017: 18.7,
		2018: 18.6,
		2019: 18.6,
		2020: 18.6,
		2021: 18.6,
		2022: 18.6,
		2023: 18.6,
		2024: 18.6,
		2025: 18.6,
		2026: 18.6,
		currentYear: {{ RV_BASE_RATE }}, // {{ fail_on('2026-12-31') }}
		2027: 18.6, // ESTIMATED (2025)
	},
}

// Full list: azubi, employee, selfEmployed, studentEmployee, studentSelfEmployed, studentUnemployed, unemployed
// TODO: Move to another file
const occupations = {
	salaryOrIncome: (occupation) => (['employee', 'azubi'].includes(occupation) ? 'salary' : 'income'),
	isEmployed: (occupation) => ['employee', 'azubi', 'studentEmployee'].includes(occupation),
	isSelfEmployed: (occupation) => ['selfEmployed', 'studentSelfEmployed'].includes(occupation),
	isUnemployed: (occupation) => ['unemployed', 'studentUnemployed'].includes(occupation),
	isStudent: (occupation) => ['studentUnemployed', 'studentEmployee', 'studentSelfEmployed'].includes(occupation),
	isLowIncome: (monthlyIncome) => monthlyIncome <= taxes.maxMinijobIncome,
	isMinijob: function(occupation, monthlyIncome){
		// Note: A minijob does not guarantee the minijob (self-pay) tariff.
		// A student with a minijob would still pay the student tariff.
		return (
			occupations.isEmployed(occupation)
			&& occupation !== 'azubi' // No minijob tariff for an Ausbildung
			&& monthlyIncome <= taxes.maxMinijobIncome
		);
	},
};
{% endjs %}