{% js %}
const bafogBedarfssatz = {{ BAFOG_BEDARFSSATZ }};

const healthInsurance = {
	defaultRate: {{ GKV_BASE_RATE_EMPLOYEE }}/100,
	selfPayRate: {{ GKV_BASE_RATE_SELF_PAY }}/100,  // Rate without Krankengeld
	studentRate: {{ GKV_BASE_RATE_STUDENT }}/100,
	minMonthlyIncome: {{ GKV_MIN_INCOME }},
	maxMonthlyIncome: {{ GKV_MAX_INCOME }}/12,
	minPrivateMonthlyIncome: {{ PKV_MIN_INCOME }}/12, // Below this amount you get rejected
	minFreiwilligMonthlyIncome: {{ GKV_FREIWILLIG_VERSICHERT_MIN_INCOME }}/12,
	maxFamilienversicherungIncome: {{ GKV_FAMILIENVERSICHERUNG_MAX_INCOME }},
	maxMidijobIncome: {{ MIDIJOB_MAX_INCOME }},
	azubiFreibetrag: {{ GKV_AZUBI_FREIBETRAG }},
	maxNebenjobIncome: {{ GKV_NEBENJOB_MAX_INCOME }},
	factorF: {{ GKV_FACTOR_F }},
	kskMinimumIncome: {{ KSK_MIN_INCOME }},
	averageZusatzbeitrag: {{ GKV_ZUSATZBEITRAG_AVERAGE }}/100,
	companies: {
		aok: {
			name: 'AOK Nordost',
			zusatzbeitrag: {{ GKV_ZUSATZBEITRAG_AOK }}/100,
		},
		barmer: {
			name: 'Barmer',
			zusatzbeitrag: {{ GKV_ZUSATZBEITRAG_BARMER }}/100,
		},
		dak: {
			name: 'DAK',
			zusatzbeitrag: {{ GKV_ZUSATZBEITRAG_DAK }}/100,
		},
		hkk: {
			name: 'hkk',
			zusatzbeitrag: {{ GKV_ZUSATZBEITRAG_HKK }}/100,
		},
		tk: {
			name: 'Techniker Krankenkasse',
			zusatzbeitrag: {{ GKV_ZUSATZBEITRAG_TK }}/100,
		},
	},
	private: {
		{{ fail_on('2026-01-01') }}
		pflegeversicherung: [  // Ages 0-99
			47.70,
			47.70,
			47.70,
			47.70,
			47.70,
			47.70,
			47.70,
			47.70,
			47.70,
			47.70,
			47.70,
			47.70,
			47.70,
			47.70,
			47.70,
			47.70,
			47.70,
			47.70,
			47.70,
			48.54,
			49.41,
			50.31,
			51.23,
			52.18,
			53.15,
			54.16,
			55.19,
			56.26,
			57.36,
			58.49,
			59.67,
			60.89,
			62.15,
			63.45,
			64.81,
			66.22,
			67.68,
			69.20,
			70.78,
			72.43,
			74.15,
			75.95,
			77.82,
			79.79,
			81.84,
			83.99,
			86.25,
			88.63,
			91.13,
			93.76,
			96.53,
			99.45,
			102.54,
			105.79,
			109.22,
			112.85,
			116.69,
			120.76,
			125.09,
			129.69,
			134.59,
			139.80,
			145.36,
			151.28,
			157.61,
			164.39,
			171.65,
			179.44,
			187.82,
			196.84,
			206.57,
			217.08,
			228.43,
			240.70,
			253.98,
			268.39,
			284.04,
			301.07,
			319.64,
			339.92,
			362.11,
			386.36,
			412.84,
			441.69,
			473.02,
			506.89,
			543.36,
			582.43,
			624.08,
			668.26,
			714.85,
			763.66,
			814.42,
			866.73,
			920.00,
			973.35,
			1025.60,
			1075.08,
			1120.59,
			1160.99,
		],
		pflegeversicherungStudent: 25.97, // Fixed price, and only for the student age range
		krankentagegeld: {
			15: 2.08,
			16: 2.12,
			17: 2.16,
			18: 2.20,
			19: 2.24,
			20: 2.28,
			21: 2.32,
			22: 2.38,
			23: 2.42,
			24: 2.48,
			25: 2.52,
			26: 2.58,
			27: 2.64,
			28: 2.70,
			29: 2.76,
			30: 2.84,
			31: 2.90,
			32: 2.98,
			33: 3.06,
			34: 3.14,
			35: 3.22,
			36: 3.32,
			37: 3.40,
			38: 3.52,
			39: 3.62,
			40: 3.74,
			41: 3.88,
			42: 4.00,
			43: 4.14,
			44: 4.30,
			45: 4.46,
			46: 4.64,
			47: 4.82,
			48: 5.02,
			49: 5.22,
			50: 5.44,
			51: 5.70,
			52: 5.96,
			53: 6.26,
			54: 6.58,
			55: 6.94,
			56: 7.30,
			57: 7.68,
			58: 8.08,
			59: 8.50,
			60: 8.50,
			61: 8.52,
			62: 8.52,
			63: 8.52,
			64: 8.52,
		},
		tariffs: {
			basic: {
				name: "Hallesche NK.select S 1200",
				deductible: 1200,
				baseContribution: [
					115.62,
					115.62,
					115.62,
					115.62,
					115.62,
					115.62,
					115.62,
					115.62,
					115.62,
					115.62,
					115.62,
					115.62,
					115.62,
					115.62,
					115.62,
					115.62,
					115.62,
					150.04,
					150.04,
					150.04,
					150.04,
					173.32,
					179.38,
					185.54,
					191.74,
					197.89,
					204.00,
					210.10,
					216.18,
					222.25,
					228.23,
					234.03,
					239.78,
					245.57,
					251.44,
					257.51,
					263.82,
					270.42,
					277.45,
					284.97,
					292.80,
					300.95,
					309.40,
					318.16,
					327.21,
					336.55,
					346.17,
					356.05,
					366.20,
					376.60,
					387.23,
					398.14,
					409.24,
					420.60,
					432.15,
					443.85,
					455.83,
					468.08,
					480.63,
					493.52,
					506.77,
					520.42,
					534.49,
					548.85,
					563.68,
					577.76,
					592.14,
					606.54,
					620.95,
					635.28,
					649.46,
					663.38,
					676.92,
					689.92,
					702.17,
					713.59,
					723.97,
					733.84,
					743.19,
					751.96,
					760.18,
					767.80,
					774.77,
					781.04,
					786.51,
					791.12,
					794.72,
					797.06,
					797.93,
					797.93,
					797.93,
					797.93,
					797.93,
					797.93,
					797.93,
					797.93,
					797.93,
					797.93,
					797.93,
					797.93,
				],
			},
			premium: {
				name: "Hallesche NK.select XL Bonus",
				deductible: 0,
				baseContribution: [
					304.91,
					304.91,
					304.91,
					304.91,
					304.91,
					304.91,
					304.91,
					304.91,
					304.91,
					304.91,
					304.91,
					304.91,
					304.91,
					304.91,
					304.91,
					304.91,
					304.91,
					366.67,
					366.67,
					366.67,
					366.67,
					487.69,
					497.48,
					507.62,
					518.02,
					528.38,
					538.77,
					549.15,
					559.49,
					569.78,
					579.90,
					589.90,
					599.75,
					609.74,
					619.85,
					630.19,
					640.94,
					652.23,
					664.03,
					676.64,
					689.69,
					703.18,
					717.22,
					731.74,
					746.68,
					762.23,
					778.34,
					795.00,
					812.18,
					829.94,
					848.20,
					867.01,
					886.48,
					906.49,
					926.94,
					948.09,
					969.65,
					991.97,
					1014.73,
					1038.33,
					1062.59,
					1087.53,
					1112.88,
					1138.76,
					1164.89,
					1189.32,
					1213.66,
					1237.89,
					1261.90,
					1285.55,
					1308.79,
					1331.40,
					1353.64,
					1375.31,
					1396.12,
					1416.10,
					1435.07,
					1453.05,
					1469.99,
					1485.87,
					1500.64,
					1514.25,
					1526.69,
					1537.82,
					1547.49,
					1555.55,
					1561.83,
					1565.98,
					1567.47,
					1567.47,
					1567.47,
					1567.47,
					1567.47,
					1567.47,
					1567.47,
					1567.47,
					1567.47,
					1567.47,
					1567.47,
					1567.47,
				],
			},
			basicStudent: {
				name: "Ottonova Study Protect",
				deductible: 500,
				baseContribution: {
					16: 84.28,
					17: 84.28,
					18: 84.28,
					19: 84.28,
					20: 105.38,
					21: 105.38,
					22: 105.38,
					23: 105.38,
					24: 105.38,
					25: 115.71,
					26: 115.71,
					27: 115.71,
					28: 115.71,
					29: 115.71,
					30: 138.98,
					31: 138.98,
					32: 138.98,
					33: 138.98,
					34: 138.98,
					35: 150.12,
					36: 150.12,
					37: 150.12,
					38: 150.12,
				},
			},
			premiumStudent: {
				name: "Ottonova Study Free",
				deductible: 0,
				baseContribution: {
					16: 100.69,
					17: 100.69,
					18: 100.69,
					19: 100.69,
					20: 126.12,
					21: 126.12,
					22: 126.12,
					23: 126.12,
					24: 126.12,
					25: 138.18,
					26: 138.18,
					27: 138.18,
					28: 138.18,
					29: 138.18,
					30: 165.52,
					31: 165.52,
					32: 165.52,
					33: 165.52,
					34: 165.52,
					35: 178.32,
					36: 178.32,
					37: 178.32,
					38: 178.32,
				},
			},
		},
	},
}

const pflegeversicherung = {
	defaultRate: {{ PFLEGEVERSICHERUNG_BASE_RATE }}/100,
	surchargeRate: {{ PFLEGEVERSICHERUNG_MAX_RATE }}/100,
	discountPerChild: {{ PFLEGEVERSICHERUNG_DISCOUNT_PER_CHILD }}/100,
	minimumChildCountForDiscount: {{ PFLEGEVERSICHERUNG_DISCOUNT_MIN_CHILDREN }},
	maximumChildCountForDiscount: {{ PFLEGEVERSICHERUNG_DISCOUNT_MAX_CHILDREN }},
	employerRate: {{ PFLEGEVERSICHERUNG_BASE_RATE }}/100/2, // Employer doesn't contribute to surcharge
	defaultRateMaxAge: {{ PFLEGEVERSICHERUNG_BASE_RATE_MAX_AGE }}, // Above this age, if you don't have kids, you pay the surchargeRate
};

const taxes = {
	church: {
		default: {{ CHURCH_TAX_RATE }} / 100,
		bw: {{ CHURCH_TAX_RATE_BW_BY }} / 100,
		by: {{ CHURCH_TAX_RATE_BW_BY }} / 100,
	},
	arbeitslosenversicherungRate: {{ ARBEITSLOSENVERSICHERUNG_EMPLOYEE_RATE }}/100,
	beitragsbemessungsgrenze: {
		2000: { west: 4500 * 12, east: 3750 * 12 },
		2001: { west: 4500 * 12, east: 3750 * 12 },
		2002: { west: 4500 * 12, east: 3750 * 12 },
		2003: { west: 5100 * 12, east: 4250 * 12 },
		2004: { west: 5150 * 12, east: 4350 * 12 },
		2005: { west: 5200 * 12, east: 4400 * 12 },
		2006: { west: 5250 * 12, east: 4400 * 12 },
		2007: { west: 5250 * 12, east: 4550 * 12 },
		2008: { west: 5300 * 12, east: 4500 * 12 },
		2009: { west: 5400 * 12, east: 4550 * 12 },
		2010: { west: 5500 * 12, east: 4650 * 12 },
		2011: { west: 5500 * 12, east: 4800 * 12 },
		2012: { west: 5600 * 12, east: 4800 * 12 },
		2013: { west: 5800 * 12, east: 4900 * 12 },
		2014: { west: 5950 * 12, east: 5000 * 12 },
		2015: { west: 6050 * 12, east: 5200 * 12 },
		2016: { west: 6200 * 12, east: 5400 * 12 },
		2017: { west: 6350 * 12, east: 5700 * 12 },
		2018: { west: 6500 * 12, east: 5800 * 12 },
		2019: { west: 6700 * 12, east: 6150 * 12 },
		2020: { west: 6900 * 12, east: 6450 * 12 },
		2021: { west: 7100 * 12, east: 6700 * 12 },
		2022: { west: 7050 * 12, east: 6750 * 12 },
		2023: { west: 7300 * 12, east: 7100 * 12 },
		2024: { west: 7550 * 12, east: 7450 * 12 },
		currentYear: { west: {{ BEITRAGSBEMESSUNGSGRENZE }}, east: {{ BEITRAGSBEMESSUNGSGRENZE }} }, // {{ fail_on('2025-12-31') }}
		2025: { west: {{ BEITRAGSBEMESSUNGSGRENZE }}, east: {{ BEITRAGSBEMESSUNGSGRENZE }} },
		2026: { west: {{ BEITRAGSBEMESSUNGSGRENZE }}, east: {{ BEITRAGSBEMESSUNGSGRENZE }} }, // ESTIMATED (2025)
		2027: { west: {{ BEITRAGSBEMESSUNGSGRENZE }}, east: {{ BEITRAGSBEMESSUNGSGRENZE }} }, // ESTIMATED (2025)
	},
	grundfreibetrag: {{ GRUNDFREIBETRAG }},
	kinderfreibetrag: {{ KINDERFREIBETRAG }},
	entlastungsbetragAlleinerziehende: {{ ENTLASTUNGSBETRAG_ALLEINERZIEHENDE }},
	entlastungsbetragAlleinerziehendePerChild: {{ ENTLASTUNGSBETRAG_ALLEINERZIEHENDE_EXTRA_CHILD }},
	kindergeldPerChild: {{ KINDERGELD }},
	solidarity: { // https://www.finanztip.de/solidaritaetszuschlag/
		minIncomeTax: {{ SOLIDARITY_TAX_MILDERUNGSZONE_MIN_INCOME_TAX }},  // Above this, you pay solidarity tax
		milderungszoneRate: {{ SOLIDARITY_TAX_MILDERUNGSZONE_RATE }}, // percent of incomeTax - minIncomeTax
		maxRate: {{ SOLIDARITY_TAX_MAX_RATE }},
	},
	minVorsorgepauschal: {{ VORSORGEPAUSCHAL_MIN }},
	minVorsorgepauschalTaxClass3: {{ VORSORGEPAUSCHAL_MIN_TAX_CLASS_3 }},
	{{ fail_on('2025-12-31') }}
	incomeTaxBrackets: {  // ยง 32a EStG - https://www.lohn-info.de/lohnsteuerzahlen.html
		1: {
			formula: (x, y, z) => 0,
			minIncome: -Infinity,
			maxIncome: {{ GRUNDFREIBETRAG }},
		},
		2: {
			formula: (x, y, z) => (932.30 * y + 1400) * y,
			minIncome: {{ GRUNDFREIBETRAG }},
			maxIncome: {{ INCOME_TAX_BRACKET_2_MAX_INCOME }},
		},
		3: {
			formula: (x, y, z) => (176.64 * z + 2397) * z + 1015.13,
			minIncome: {{ INCOME_TAX_BRACKET_2_MAX_INCOME }},
			maxIncome: {{ INCOME_TAX_BRACKET_3_MAX_INCOME }},
		},
		4: {
			formula: (x, y, z) => 0.42 * x - 10911.92,
			minIncome: {{ INCOME_TAX_BRACKET_3_MAX_INCOME }},
			maxIncome: {{ INCOME_TAX_BRACKET_4_MAX_INCOME }},
		},
		5: {
			formula: (x, y, z) => {{ INCOME_TAX_MAX_RATE }} / 100 * x - 19246.67,
			minIncome: {{ INCOME_TAX_BRACKET_4_MAX_INCOME }},
			maxIncome: Infinity,
		},
	},
	incomeTaxClass56: {
		maxIncome1: {{ INCOME_TAX_CLASS_56_LIMIT_1 }},
		maxIncome2: {{ INCOME_TAX_CLASS_56_LIMIT_2 }},
		maxIncome3: {{ INCOME_TAX_CLASS_56_LIMIT_3 }},
	},
	maxMinijobIncome: {{ MINIJOB_MAX_INCOME }}, // Max monthly income to be considered a minijobber
	arbeitnehmerpauschale: {{ ARBEITNEHMERPAUSCHALE }}, // Fixed yearly income tax deduction for employees
	sonderausgabenPauschbetrag: {{ SONDERAUSGABEN_PAUSCHBETRAG }}, // Fixed yearly income tax deduction
};

// https://github.com/mledoze/countries/blob/master/dist/countries.json
const pensions = {
	contractingCountries: new Set(['AL', 'AU', 'BR', 'CA', 'CL', 'IN', 'IL', 'JP', 'KR', 'MA', 'ME', 'PH', 'TN', 'TR', 'UY', 'US']),
	balkanBlockCountries: new Set(['BA', 'MK', 'RS', 'XK', 'ME']),
	disqualifyingCountries: new Set(['BA', 'MK', 'RS', 'XK', 'ME', 'TR']),
	contributionRates: {
		2000: 19.3,
		2001: 19.1,
		2002: 19.1,
		2003: 19.5,
		2004: 19.5,
		2005: 19.5,
		2006: 19.5,
		2007: 19.9,
		2008: 19.9,
		2009: 19.9,
		2010: 19.9,
		2011: 19.9,
		2012: 19.6,
		2013: 18.9,
		2014: 18.9,
		2015: 18.7,
		2016: 18.7,
		2017: 18.7,
		2018: 18.6,
		2019: 18.6,
		2020: 18.6,
		2021: 18.6,
		2022: 18.6,
		2023: 18.6,
		2024: 18.6,
		2025: 18.6,
		currentYear: {{ RV_BASE_RATE }}, // {{ fail_on('2025-12-31') }}
		2026: 18.6, // ESTIMATED (2025)
		2027: 18.6, // ESTIMATED (2025)
	},
}

// Full list: azubi, employee, selfEmployed, studentEmployee, studentSelfEmployed, studentUnemployed, unemployed
const occupations = {
	salaryOrIncome: (occupation) => (['employee', 'azubi'].includes(occupation) ? 'salary' : 'income'),
	isEmployed: (occupation) => ['employee', 'azubi', 'studentEmployee'].includes(occupation),
	isSelfEmployed: (occupation) => ['selfEmployed', 'studentSelfEmployed'].includes(occupation),
	isUnemployed: (occupation) => ['unemployed', 'studentUnemployed'].includes(occupation),
	isStudent: (occupation) => ['studentUnemployed', 'studentEmployee', 'studentSelfEmployed'].includes(occupation),
	isLowIncome: (monthlyIncome) => monthlyIncome <= taxes.maxMinijobIncome,
	isMinijob: function(occupation, monthlyIncome){
		// Note: A minijob does not guarantee the minijob (self-pay) tariff.
		// A student with a minijob would still pay the student tariff.
		return (
			occupations.isEmployed(occupation)
			&& occupation !== 'azubi' // No minijob tariff for an Ausbildung
			&& monthlyIncome <= taxes.maxMinijobIncome
		);
	},
};
{% endjs %}